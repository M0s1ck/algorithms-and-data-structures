# A3 HyperLogLog

Все файлы тут: https://github.com/M0s1ck/algorithms-and-data-structures/tree/main/set5/a3

## Этап 1. Создание инфраструктуры

Для генерации потока данных реализован класс RandomStreamGen. Он формирует последовательность строк случайной длины от 1 до 30 символов. В качестве допустимых символов используются латинские буквы верхнего и нижнего регистра, цифры и символ тире.

Для хеширования элементов потока реализован класс HashFuncGen, использующий 32-битный алгоритм FNV-1a. Данная хеш-функция обладает хорошими свойствами равномерности распределения, проста в реализации и широко применяется в задачах потоковой обработки данных. Размер области значений хеша соответствует M = 2^32.

---

## Этап 2. Реализация и оценка точности алгоритма HyperLogLog

На втором этапе был реализован стандартный вероятностный алгоритм HyperLogLog для оценки количества уникальных элементов в потоке данных.

Алгоритм использует хеш-значения элементов, первые B бит которых определяют номер регистра, а оставшиеся биты используются для вычисления позиции первого ненулевого бита. Для хранения состояния алгоритма используется массив из m = 2^B регистров, в каждом из которых хранится максимальное наблюдаемое значение соответствующей величины.

Для получения оценки кардинальности используется стандартная формула HyperLogLog с поправками для малых значений мощности множества. Параметр B был выбран равным 10, что соответствует 1024 регистрами и обеспечивает разумный баланс между точностью оценки и затратами памяти.

Для оценки точности алгоритма параллельно с HyperLogLog вычисляется точное число уникальных элементов с помощью структуры unordered_set. Эксперимент проводится на нескольких независимых запусках, что позволяет вычислить среднее значение оценки E(Nt) и стандартное отклонение σ(Nt) для каждого шага обработки потока.

Результаты экспериментов сохраняются в CSV-файл, который затем используется для построения графиков.

---

## Этап 3. Анализ результатов работы стандартного алгоритма HyperLogLog

На данном этапе проводится сравнение экспериментальных результатов работы алгоритма HyperLogLog с теоретическими оценками его точности и устойчивости. Анализ основан на данных одного экспериментального запуска при параметре B = 10, что соответствует числу регистров m = 1024.

### 1. Точность алгоритма и соответствие теоретическим оценкам

Теоретическая относительная стандартная ошибка HyperLogLog оценивается формулой  
1.04 / √m, где m = 2^B.  
Для B = 10 получаем:

√m = √1024 = 32  
1.04 / 32 ≈ 0.0325  
1.3 / 32 ≈ 0.0406  

Таким образом, ожидаемый диапазон относительных отклонений составляет приблизительно от 3.3% до 4.1%.

По экспериментальным данным видно, что средняя оценка HyperLogLog близка к истинному числу уникальных элементов на всех шагах потока. Например, при размере потока 200000 истинное значение равно 189640, а средняя оценка составляет 193610, что соответствует относительной ошибке около 2.1%. Аналогичные значения наблюдаются и на промежуточных шагах, где отклонения остаются в пределах нескольких процентов.

Следовательно, практическая точность алгоритма укладывается в теоретически ожидаемый диапазон отклонений.

### 2. Стабильность оценки и анализ дисперсии

Стабильность оценки характеризуется стандартным отклонением σ. Из полученных данных видно, что абсолютное значение стандартного отклонения растёт по мере увеличения размера потока, что является ожидаемым поведением для алгоритмов с постоянной относительной ошибкой.

При этом относительное стандартное отклонение σ / E(Nt) остаётся примерно постоянным и находится на уровне 3–4%. Это указывает на устойчивость алгоритма и отсутствие деградации качества оценки при росте числа обрабатываемых элементов.

Также отсутствуют резкие скачки дисперсии, что свидетельствует о корректной работе хеш-функции и равномерном распределении элементов по регистрами.

### 3. Эффективность выбранных констант и их влияние на результат

Выбор параметра B = 10 обеспечивает использование 1024 регистров, что соответствует компромиссу между точностью и потреблением памяти. Теоретическая ошибка при таком значении B составляет около 3%, что подтверждается экспериментальными результатами.

Использование 32-битной хеш-функции FNV-1a оказалось достаточным для равномерного распределения значений и стабильной работы алгоритма на выбранных объёмах данных. Коррекция для малых значений кардинальности также позволяет избежать систематического смещения оценки на начальных этапах обработки потока.

В целом, выбранные константы обеспечивают предсказуемое и устойчивое поведение HyperLogLog, соответствующее его теоретическим свойствам и практическим ожиданиям.
